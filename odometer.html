<html>
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="css/pagery.css">
    <link rel="stylesheet" type="text/html" href="js/x3dom.css"/>

    <script type="text/javascript" src="js/reify.js"></script>

    <script type="text/javascript" src="js/x3dom.js"></script>
    <script type="text/javascript" src="js/3d.js"></script>
    <script type="text/javascript" src="js/colors.js"></script>
    <script type="text/javascript" src="js/cycles-x3dom.js"></script>



    <script type="text/javascript" src="js/odometer.js"></script>
    <script type="text/javascript" src="js/odometer-dom.js"></script>
    <script type="text/javascript" src="js/odometer-expression.js"></script>

    <script>
        const permColumns = [ '#', 'label', 'alias', 'monomial', 'index' ];
        const columnsNoDiagram = [ '#', 'label', 'alias', 'monomial', 'cycles' ];
        const columns = [ '#', 'label', 'alias', 'monomial', 'cycles', 'diagram' ];

<!--        function runScenario() {-->
<!--            Box.of( [ 2 ] );-->
<!--            Box.of( [ 5 ] );-->
<!--            Box.of( [ 2, 5 ] );-->
<!--            document.getElementById( 'boxPerms' ).appendChild( reify( 'div', {}, [-->
<!--                ...Box.list().map( box => box.permBox.pointsDomNode( permColumns, `Indexes of [${ box.odometer.bases }]` ) ),-->
<!--                Box.of( [ 2, 4, 5 ] ).permBox.pointsDomNode( permColumns )-->
<!--            ] ) );-->
<!--            document.getElementById( 'boxActions' ).appendChild( reify( 'div', {},-->
<!--                Box.list().map( box => box.cyclesDomNode( columnsNoDiagram ) )-->
<!--            ) );-->
<!--            document.getElementById( 'boxCompositions' ).appendChild( reify( 'div', {},-->
<!--                [-->
<!--                    cyclesDomNode( [ product( Box.of([4,5]).permBox[1], Box.of([2]).permBox[0], false ) ], columns ),-->
<!--                    cyclesDomNode( [ compose( Box.of([2,4,5]).permBox[2], Box.of([2,4,5]).permBox[4], true ) ], columns ),-->
<!--                ]-->
<!--            ) );-->
<!--            x3dom.reload();-->
<!--        }-->

        function putHtml( result, param ) {
            if ( result instanceof Cycles ) {
                const cols = document.getElementById( 'cyclesDiagramToggle' ).checked
                    ? columns
                    : columnsNoDiagram;
                document
                    .getElementById( 'expressionScript' )
                    .parentNode
                    .appendChild( reify( 'div', { 'class': 'expressionScriptResult' }, [ cyclesDomNode( [ result ], cols ) ] ) );
            }
        }

        function clearResults() {
            document
                .querySelectorAll( '.expressionScriptResult' )
                .forEach( element => element.parentNode.removeChild( element ) );
        }

        function calculate( script, sourceElement ) {
            if ( document.getElementById( 'clearOnCalculate' ).checked ) {
                clearResults();
            }
            const isFormula = document.getElementById( 'formulaToggle' ).checked;
            try {
                const result = isFormula
                    ? evaluateFormulas( script )
                    : eval( script );
                result.forEach( r => putHtml( r[1] ) );
            } catch ( e ) {
                putHtml( `<font color='red'>${ e }</font>` );
                throw e;
            }
        }

        function calculateNow() {
            const sourceId = 'expressionScript';
            const sourceElement = document.getElementById( sourceId );

            calculate( sourceElement.value, 'calculationResult' );

            x3dom.reload();
        }
    </script>
</head>
<body onload="calculateNow()">
    <input type="button" value="eval" onclick="calculateNow()"/>
    <input type="button" value="clear" onclick="clearResults()"/>
    <label class="summaryLeft">clear on calculate<input type="checkbox" checked="checked" id="clearOnCalculate"/></label>
    <label class="summaryLeft">formula<input type="checkbox" checked="checked" id="formulaToggle"/></label>
    <label class="summaryLeft">cycles<input type="checkbox" id="cyclesDiagramToggle" onclick="calculateNow()"/></label>
    <br/>
    <textarea id="expressionScript" class="expressionScriptPanel" rows="6">#
(2 % 4)
(4 % 2)
    </textarea>
</body>
</html>