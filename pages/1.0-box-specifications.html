<script>
    if ( urlParam.has( "bases2d" ) ) {
        pageScope.bases2d = urlParam.get( "bases2d" ).split( "," ).map( b => Number( b ) );
    } else {
        pageScope.bases2d = [ 3, 4 ];
    }

    pageScope.orb2d = new Orbitation( pageScope.bases2d, { truncated: false } );

    if ( urlParam.has( "bases3d" ) ) {
        pageScope.bases3d = urlParam.get( "bases3d" ).split( "," ).map( b => Number( b ) );
    } else {
        pageScope.bases3d = [ 2, 3, 4 ];
    }

    pageScope.orb3d = new Orbitation( pageScope.bases3d, { truncated: false } );
    pageScope.box3d = new BoxGroup( pageScope.bases3d, { toggles: [ 'all-indexes', 'all-layers' ] } );

    if ( urlParam.has( "bases4d" ) ) {
        pageScope.bases4d = urlParam.get( "bases4d" ).split( "," ).map( b => Number( b ) );
    } else {
        pageScope.bases4d = [ 2, 3, 4, 5 ];
    }

    pageScope.orb4d = new Orbitation( pageScope.bases4d, { truncated: false } );

    pageScope.serialText = ( coord, serial ) => `${ serial }<sub>(${ coord.join( ',' ) })</sub>`;
    pageScope.coordText = ( coord, serial ) => `(${ coord.join( ',' ) })<sub>${ serial }</sub>`;

</script>

<h2>Specification</h2>

Consider a box with <a class="eval" title="pageScope.bases3d.length">RANK</a> sides of different lengths: for example <a class="eval" title="pageScope.orb3d.specification()">SPEC</a>;
it contains <a class="eval" title="pageScope.orb3d.volume">VOLUME</a> points.
<br/>
<br/>
The specification <a class="eval" title="pageScope.orb3d.specification()">SPEC</a> means
"<a class="eval" title="pageScope.bases3d.map( (b,i) => ( i == pageScope.bases3d.length - 1 ) ? `a sequence of ${ b } points` : `${ b } copies of ` ).join( '' )"></a>".
<br/>
<br/>
<span class="evalNode" title="boxPackingTable( pageScope.bases3d, pageScope.serialText )"></span>
<br/>

The reverse specification <a class="eval" title="pageScope.orb3d.specification( true )">SPEC</a> means
"<a class="eval" title="[ ...pageScope.bases3d ].reverse().map( (b,i) => ( i == pageScope.bases3d.length - 1 ) ? `a sequence of ${ b } points` : `${ b } copies of ` ).join( '' )"></a>".
<br/>
<br/>
<span class="evalNode" title="boxPackingTable( [ ...pageScope.bases3d ].reverse(), pageScope.serialText )"></span>
<br/>


There are 6 possible specifications for this box, the other four being:
<a class="eval" title="pageScope.orb3d.specification( false, 1 )">SPEC</a>,
<a class="eval" title="pageScope.orb3d.specification( false, 2 )">SPEC</a>,
<a class="eval" title="pageScope.orb3d.specification( true, 1 )">SPEC</a>,
<a class="eval" title="pageScope.orb3d.specification( true, 2 )">SPEC</a>.
<br/>
<br/>

<h3>Place Values, Coordinates and Index numbers</h3>

A box specification aligns with the numeral place value convention where the significance of each place value increases from right-to-left,
but the base counted by each place value varies with the box side lengths.
<br/>
<br/>


Each point in the box <a class="eval" title="pageScope.orb3d.specification()"></a> can have a unique coordinate in the range:
[ (<a class="eval" title="new Array( pageScope.bases3d.length ).fill( 0 ).join( ', ' )"></a> ),
(<a class="eval" title="pageScope.bases3d.map( b => b - 1 ).join( ', ' )"></a>) ],
and each coordinate represents a numeral,
with respect to the box specification,
that evaluates to a unique index number in the range
[ 0, <a class="eval" title="( pageScope.box3d.box.volume - 1 )"></a> ].

The specification determines the sequence of place values,
and the scalar product of the place values with each coordinate produces the corresponding index number.<br/>
<br/>

For example, the box specification <a class="eval" title="pageScope.orb3d.specification()"></a>
has the place values structure [ <a class="eval" title="pageScope.orb3d.placeValuesSpec().join( ', ' )"></a> ]
which evaluates to [ <a class="eval" title="pageScope.orb3d.placeValues().join( ', ' )"></a> ],
and produces the following coordinates and index numbers:
<br/>
<br/>

<span class="evalNode" title="boxPlaceValueTable( pageScope.bases3d, pageScope.orb3d.volume / Math.max( ...pageScope.bases3d ) )"></span>
<br/>

<div  class="pagebreak"></div>

However, the reverse box specification <a class="eval" title="pageScope.orb3d.specification( true )"></a>
has the place values structure [ <a class="eval" title="pageScope.orb3d.placeValuesSpec( true ).join( ', ' )"></a> ]
which evaluates to [ <a class="eval" title="pageScope.orb3d.placeValues( true ).join( ', ' )"></a> ],
and produces the following, partially different, coordinates and index numbers:
<br/>
<br/>
<span class="evalNode" title="boxPlaceValueTable(
        [ ...pageScope.bases3d ].reverse(),
        pageScope.orb3d.volume / Math.max( ...pageScope.bases3d )
    )"></span>
<br/>

The rows and columns from any one specification can always be reordered to match coordinates with any other specification from the same box,
for example:
<br/>
<br/>
<span class="evalNode" title="boxPlaceValueTable(
        [ ...pageScope.bases3d ].reverse(),
        pageScope.orb3d.volume / Math.max( ...pageScope.bases3d ),
        new Array( pageScope.bases3d.length ).fill( 0 ).map( (_,i) => i ).reverse()
    )"></span>
<br/>

<h3>Index Comparisons, Permutations, and Cycles</h3>

The index numbers for corresponding coordinates, for any two specifications from the same box, can be compared:
<br/>
<br/>
<span class="evalNode" title="compareBoxSpecificationsTable(
        pageScope.bases3d,
        true
    )"></span>
<br/>

<script>
    pageScope.e_0_cycles = pageScope
        .box3d
        .findActionByLabel( 'e_0' )
        .getCycles()
        .map( cycle => cycle.map( point => point.id ) );

    pageScope.z_0_cycles = pageScope
        .box3d
        .findActionByLabel( 'z_0' )
        .getCycles()
        .map( cycle => cycle.map( point => point.id ) );

    pageScope.z_0i_cycles = pageScope
        .box3d
        .findActionByLabel( 'z_0i' )
        .getCycles()
        .map( cycle => cycle.map( point => point.id ) );
</script>

The second row is a permutation of the first row and this maps all the points in the box back onto all the points in the box.
<br/>
<br/>

Specifically:
<ul class="eval" title="[
    pageScope
        .z_0_cycles
        .filter( cycle => cycle.length > 1 )
        .map( cycle => cycle.map( ( c, i ) => `${ c }${ i + 1 == cycle.length ? ' &rarr; 1' : ' &rarr; ' + cycle[ i + 1 ] + ' | ' }` ).join( '' ) )
        .map( ( cycle, i ) => `<li>${ i == 0 ? 'A' : 'Another' } cycle of length ${ pageScope.orb3d.order( pageScope.bases3d[0] ) }:<br/><br/>${ cycle }</li>` )
        .flatMap( cycle => cycle )
        .join( '\n' ),

    '<li>Cycles of length 1, or fixed points:<br/><br/>' + pageScope
        .z_0_cycles
        .filter( cycle => cycle.length == 1 )
        .map( cycle => cycle.map( c => `${ c } &rarr; ${ c }` ) )
        .join( ' | ' ) + '</li>'

]"></ul>


This is written more succinctly as an expression in cycle notation:
<br/>
<br/>
<span class="eval" title="pageScope
            .z_0_cycles
            .map( cycle => `( ${ cycle.join( ' ' ) } )` )
            .join( ' ' )"></span>
<br/>
<br/>

NB: Here it's useful to retain the fixed points in the expression, even though they are usually elided,
so that the entire set of points is presented.
<br/>
<br/>

<hr class="pagebreak"/>

Swapping the two specifications in the comparison produces the same cycles in reverse:
<br/>
<br/>
<span class="evalNode" title="compareBoxSpecificationsTable(
        [ ...pageScope.bases3d ].reverse(),
        true,
        0
    )"></span>
<br/>

<span class="eval" title="pageScope
            .z_0i_cycles
            .map( cycle => rotateArray( cycle, -1 ) )
            .map( cycle => `( ${ cycle.join( ' ' ) } )` )
            .join( ' ' )"></span>
<br/>
<br/>
<br/>

Comparing a specification with itself always produces a set of fixed points only:
<br/>
<br/>
<span class="evalNode" title="compareBoxSpecificationsTable(
        pageScope.bases3d,
        false,
        0
    )"></span>
<br/>
<br/>

<span class="eval" title="pageScope
            .e_0_cycles
            .map( cycle => rotateArray( cycle, -1 ) )
            .map( cycle => `( ${ cycle.join( ' ' ) } )` )
            .join( ' ' )"></span>
<br/>
<br/>


